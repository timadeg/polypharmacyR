% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/detect_treatment_episodes.R
\name{detect_treatment_episodes}
\alias{detect_treatment_episodes}
\title{Detect Treatment Episodes from CPRD Prescription Data}
\usage{
detect_treatment_episodes(processed_data)
}
\arguments{
\item{processed_data}{Data frame containing processed CPRD prescription data
from \code{process_cprd_data()}. Must contain columns: patid, prodcodeid,
issuedate, end_date, and grace_period.}
}
\value{
A data frame containing treatment episodes with the following columns:
\describe{
  \item{patid}{Patient identifier}
  \item{prodcodeid}{Product code identifier}
  \item{episode_id}{Sequential episode number for each patient-drug combination}
  \item{episode_start}{Date of first prescription in episode}
  \item{episode_end}{Date when last prescription in episode expires}
  \item{n_prescriptions}{Number of prescriptions in the episode}
  \item{episode_duration}{Duration of episode in days}
}
}
\description{
This function identifies continuous treatment episodes from prescription
records by detecting gaps between prescriptions that exceed a specified
grace period. It groups consecutive prescriptions into episodes and
calculates episode-level summaries.
}
\details{
Treatment episodes are defined as continuous periods of drug exposure,
allowing for gaps up to the grace period between prescriptions. A new
episode begins when the gap between the end of one prescription and the
start of the next exceeds the grace period.

The function performs the following steps:
\itemize{
  \item Calculates gaps between consecutive prescriptions for each patient-drug
  \item Flags new episodes when gaps exceed the grace period
  \item Assigns sequential episode IDs
  \item Summarizes episodes with start/end dates, prescription counts, and duration
}
}
\examples{
\dontrun{
# First process the data
processed_data <- process_cprd_data(drug_issue, patient, product_dict,
                                   practice, staff)

# Then detect episodes
episodes <- detect_treatment_episodes(processed_data)
}

}
